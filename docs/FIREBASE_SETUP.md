# Firebase Setup Guide - Taskmaster App

## âœ… What You Already Have

- âœ… Firebase CLI installed and logged in as `sagearbor@gmail.com`
- âœ… Firebase project created: `taskmaster-app-3d480`
- âœ… Flutter app with mock services working

## ðŸŽ¯ What We Need To Do

Connect your Flutter app to your Firebase project so data persists and users can authenticate.

---

## Step 1: Install FlutterFire CLI

```bash
# Install the FlutterFire CLI globally
dart pub global activate flutterfire_cli

# Verify installation
flutterfire --version
```

If the command isn't found, add Dart global packages to your PATH:
```bash
export PATH="$PATH:$HOME/.pub-cache/bin"
echo 'export PATH="$PATH:$HOME/.pub-cache/bin"' >> ~/.bashrc
source ~/.bashrc
```

---

## Step 2: Configure Firebase in Your Flutter App

Run this command from your project root:

```bash
flutterfire configure
```

This will:
1. Show you a list of your Firebase projects
2. Select `taskmaster-app-3d480` (use arrow keys)
3. Select platforms you want to support (choose: **android, ios, web**)
4. Generate `lib/firebase_options.dart` with your configuration

**Expected Output:**
```
âœ” Firebase projects found
âœ” Select a Firebase project: taskmaster-app-3d480
âœ” Select platforms: android, ios, web
âœ” Registered your app with Firebase
âœ” Generated lib/firebase_options.dart
```

---

## Step 3: Enable Firebase Services in Console

### A. Enable Authentication

1. Go to https://console.firebase.google.com/project/taskmaster-app-3d480
2. Click **Authentication** in left sidebar
3. Click **Get Started**
4. Enable these sign-in methods:
   - **Email/Password** â†’ Click, toggle Enable, Save
   - **Google** â†’ Click, toggle Enable, Save

### B. Create Firestore Database

1. In Firebase Console, click **Firestore Database**
2. Click **Create Database**
3. Choose **Start in test mode** (for now)
4. Select location: **us-central** (matches your project)
5. Click **Enable**

### C. Set Up Security Rules (Important!)

In Firestore Console, go to **Rules** tab and paste this:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users can read/write their own user document
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Games collection
    match /games/{gameId} {
      // Anyone authenticated can read games
      allow read: if request.auth != null;

      // Only creator can create games
      allow create: if request.auth != null &&
                      request.resource.data.creatorId == request.auth.uid;

      // Only creator or judge can update
      allow update: if request.auth != null &&
                      (resource.data.creatorId == request.auth.uid ||
                       resource.data.judgeId == request.auth.uid);

      // Only creator can delete
      allow delete: if request.auth != null &&
                      resource.data.creatorId == request.auth.uid;
    }

    // Community tasks
    match /community_tasks/{taskId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null; // For upvoting
      allow delete: if request.auth != null &&
                      resource.data.submittedBy == request.auth.uid;
    }
  }
}
```

Click **Publish** to save the rules.

---

## Step 4: Enable Firebase Hosting (for Web Deployment)

```bash
# Initialize Firebase Hosting
firebase init hosting
```

When prompted:
- **What do you want to use as your public directory?** â†’ `build/web`
- **Configure as a single-page app?** â†’ `Yes`
- **Set up automatic builds and deploys with GitHub?** â†’ `No` (for now)
- **Overwrite build/web/index.html?** â†’ `No`

---

## Step 5: Update Your App to Use Firebase

### A. Check that Firebase packages are in pubspec.yaml

Open [pubspec.yaml](pubspec.yaml) - you already have these:
```yaml
firebase_core: ^3.8.1
firebase_auth: ^5.3.3
cloud_firestore: ^5.5.1
```

### B. Switch Main Entry Point

You have Firebase implementations ready in:
- `lib/features/auth/data/datasources/firebase_auth_data_source.dart`
- `lib/features/games/data/datasources/firebase_game_data_source.dart`
- `lib/features/tasks/data/datasources/firebase_task_data_source.dart`

Update [lib/main.dart](lib/main.dart) to initialize Firebase:

```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // Generated by flutterfire

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // Initialize Firebase
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );

  // Initialize with REAL Firebase services (not mock)
  await ServiceLocator.init(useMockServices: false);

  runApp(const MyApp());
}
```

---

## Step 6: Test Firebase Connection

### A. Build and Run

```bash
# Clean build
flutter clean
flutter pub get

# Run with Firebase
flutter run -d chrome
```

### B. Test Authentication

1. Open the app in Chrome
2. Click "Register"
3. Enter email: `test@example.com` / password: `password123`
4. If successful, you should see the Home Screen

### C. Verify in Firebase Console

Go to Firebase Console â†’ Authentication â†’ Users
- You should see your test user listed!

### D. Test Game Creation

1. Click "Create Game"
2. Enter a game name
3. Submit

Go to Firebase Console â†’ Firestore Database
- You should see a new document in the `games` collection!

---

## Step 7: Deploy to Web (Optional)

Once everything works locally:

```bash
# Build the web app
flutter build web

# Deploy to Firebase Hosting
firebase deploy --only hosting
```

Your app will be live at: `https://taskmaster-app-3d480.web.app`

---

## Troubleshooting

### Issue: "MissingPluginException"
**Solution:** Restart the app after adding Firebase
```bash
flutter clean
flutter pub get
flutter run -d chrome
```

### Issue: "Firebase not initialized"
**Solution:** Make sure you ran `flutterfire configure` and the file `lib/firebase_options.dart` exists

### Issue: "Permission denied" in Firestore
**Solution:** Check that you published the Security Rules in Step 3C

### Issue: App still using mock data
**Solution:** Verify `ServiceLocator.init(useMockServices: false)` in main.dart

### Issue: "No Firebase App '[DEFAULT]' has been created"
**Solution:** Ensure `await Firebase.initializeApp()` runs before `ServiceLocator.init()`

---

## What Happens After Firebase Setup?

âœ… **User accounts persist** - Users can log in from any device
âœ… **Games save to cloud** - All game data stored in Firestore
âœ… **Real-time updates** - Players see lobby changes instantly
âœ… **Community tasks shared** - All users see submitted tasks
âœ… **Ready for production** - Can deploy to web, iOS, Android

---

## Next Steps After Firebase Works

1. **Test all features** with real data
2. **Set up Firebase indexes** if you get indexing errors
3. **Switch Security Rules to production mode** (remove test mode)
4. **Set up Firebase Analytics** (optional)
5. **Configure environment variables** for API keys
6. **Deploy to Firebase Hosting** for web version

---

## Quick Reference Commands

```bash
# Configure Firebase
flutterfire configure

# Login to Firebase
firebase login

# Check current projects
firebase projects:list

# Initialize hosting
firebase init hosting

# Deploy to web
flutter build web && firebase deploy --only hosting

# Run with Firebase (production)
flutter run -d chrome

# Run with mocks (development)
flutter run -d chrome -t lib/main_simple.dart
```